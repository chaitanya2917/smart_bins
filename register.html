<!DOCTYPE html>
<html>
<head>
    <title>New Registration</title>
    <link rel="stylesheet" href="register-style.css"> 
</head>
<body>
    <div class="login-container">
        <h2>Register</h2>
        <form>
            <label for="email">Email ID:</label>
            <input type="text" id="email" name="email" required>
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName" required>
            <label for "userId">User ID:</label>
            <input type="text" id="userId" name="userId" required>
            <label for="userPassword">Password:</label>
            <input type="password" id="userPassword" name="userPassword" required>
            <label for="confirmUserPassword">Confirm Password:</label>
            <input type="password" id="confirmUserPassword" name="confirmUserPassword" required>
            <button type="button" onclick="register()">Register</button>
        </form>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBpp9ZcMYgvNf-fRRroV4xjcVlAjTbKNTE",
            authDomain: "login-details-a2221.firebaseapp.com",
            projectId: "login-details-a2221",
            storageBucket: "login-details-a2221.appspot.com",
            messagingSenderId: "530026696513",
            appId: "1:530026696513:web:8b4e7b11462d8a0ce0dbc0"
        };

        const app = firebase.initializeApp(firebaseConfig); // Initialize Firebase here
        
        const auth = app.auth(); // Access the authentication module
        const database = app.database(); // Access the database module

        function register() {
            var email = document.getElementById("email").value;
            var fullName = document.getElementById("fullName").value;
            var userId = document.getElementById("userId").value;
            var userPassword = document.getElementById("userPassword").value;
            var confirmUserPassword = document.getElementById("confirmUserPassword").value;

            console.log(email);

            if (validate_email(email) === false) {
                alert("Email is in the wrong format");
                return;
            } else {
                alert("Email is in the correct format");
            }

            auth.createUserWithEmailAndPassword(email, userPassword)
                .then(function() {
                    var user = auth.currentUser;
                    var database_ref = database.ref();
                    var user_data = {
                        email: email,
                        fullName: fullName, 
                        userId: userId,
                        last_login: Date.now()  
                    }
                    database_ref.child('users/' + user.uid).set(user_data)
                    console.log("Hello");
                    alert("User Created!!");
                })
                .catch(function(error) {
                    var error_code = error.code;
                    var error_message = error.message;
                    alert(error_message);
                });
        }

        function validate_email(email) {
            expression = /^[^@]+@\w+(\.\w+)+\w$/;
            return expression.test(email);
        }
    </script>
    
    <script src="register.js"></script>
</body>
</html>
